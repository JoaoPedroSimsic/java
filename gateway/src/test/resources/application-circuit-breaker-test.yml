gateway:
  rate-limit:
    authenticated:
      replenish-rate: 100
      burst-capacity: 150
    unauthenticated:
      replenish-rate: 5
      burst-capacity: 10
  jwt:
    expected-issuer: "test-issuer"
    jwks-url: "http://localhost:8080/jwks"
    cache-ttl-seconds: 60
  secret: "test-secret"

spring:
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration
      - org.springframework.boot.autoconfigure.security.reactive.ReactiveUserDetailsServiceAutoConfiguration
  data:
    redis:
      host: localhost
      port: 6379
  cloud:
    gateway:
      routes:
        - id: user-service
          uri: ${USER_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/api/users/**
          filters:
            - name: CircuitBreaker
              args:
                name: userServiceCircuitBreaker
                fallbackUri: forward:/fallback/user-service

# Resilience4j configuration for tests (faster timeouts)
resilience4j:
  circuitbreaker:
    instances:
      userServiceCircuitBreaker:
        slidingWindowSize: 5
        minimumNumberOfCalls: 3
        failureRateThreshold: 50
        waitDurationInOpenState: 5000
        permittedNumberOfCallsInHalfOpenState: 2
        automaticTransitionFromOpenToHalfOpenEnabled: true
  timelimiter:
    instances:
      userServiceCircuitBreaker:
        timeoutDuration: 10s
